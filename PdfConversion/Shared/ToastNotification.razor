@namespace PdfConversion.Shared
@inject ILogger<ToastNotification> Logger

<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;">
    @foreach (var toast in Toasts)
    {
        <div class="toast show @GetToastClass(toast.Type)" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="@GetToastIcon(toast.Type) me-2"></i>
                <strong class="me-auto">@GetToastTitle(toast.Type)</strong>
                <small>@toast.Timestamp.ToString("HH:mm:ss")</small>
                <button type="button" class="btn-close" @onclick="() => RemoveToast(toast.Id)" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                @toast.Message
            </div>
        </div>
    }
</div>

@code {
    private List<Toast> Toasts = new();
    private static ToastNotification? _instance;

    public class Toast
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();
        public string Message { get; set; } = string.Empty;
        public ToastType Type { get; set; }
        public DateTime Timestamp { get; set; } = DateTime.Now;
    }

    public enum ToastType
    {
        Success,
        Error,
        Warning,
        Info
    }

    protected override void OnInitialized()
    {
        _instance = this;
    }

    public static void ShowSuccess(string message)
    {
        _instance?.Show(message, ToastType.Success);
    }

    public static void ShowError(string message)
    {
        _instance?.Show(message, ToastType.Error);
    }

    public static void ShowWarning(string message)
    {
        _instance?.Show(message, ToastType.Warning);
    }

    public static void ShowInfo(string message)
    {
        _instance?.Show(message, ToastType.Info);
    }

    private void Show(string message, ToastType type)
    {
        var toast = new Toast
        {
            Message = message,
            Type = type
        };

        Toasts.Add(toast);
        StateHasChanged();

        // Auto-dismiss after 5 seconds
        _ = Task.Delay(5000).ContinueWith(_ =>
        {
            RemoveToast(toast.Id);
        });
    }

    private void RemoveToast(string id)
    {
        var toast = Toasts.FirstOrDefault(t => t.Id == id);
        if (toast != null)
        {
            Toasts.Remove(toast);
            InvokeAsync(StateHasChanged);
        }
    }

    private string GetToastClass(ToastType type)
    {
        return type switch
        {
            ToastType.Success => "toast-success",
            ToastType.Error => "toast-error",
            ToastType.Warning => "toast-warning",
            ToastType.Info => "toast-info",
            _ => ""
        };
    }

    private string GetToastIcon(ToastType type)
    {
        return type switch
        {
            ToastType.Success => "bi bi-check-circle-fill text-success",
            ToastType.Error => "bi bi-exclamation-circle-fill text-danger",
            ToastType.Warning => "bi bi-exclamation-triangle-fill text-warning",
            ToastType.Info => "bi bi-info-circle-fill text-info",
            _ => ""
        };
    }

    private string GetToastTitle(ToastType type)
    {
        return type switch
        {
            ToastType.Success => "Success",
            ToastType.Error => "Error",
            ToastType.Warning => "Warning",
            ToastType.Info => "Info",
            _ => ""
        };
    }
}
